#!/bin/bash
# dependencies: xrandr, printf, sleep, lemonbar

width="110"
height="22"
font="$BAR_FONT"
gaps="$(bspc query -T -m focused | jq .windowGap)"

resolution="$(xrandr --nograb --current | awk '/\*/ {printf $1; exit}')"
monitor_width="${resolution/x*}"

offset_right="$((monitor_width - width - $gaps ))"
geometry_right="${width}x${height}+${offset_right}+$(( $gaps / 2))"

offset_left="$(( $gaps ))"
geometry_left="${width}x${height}+${offset_left}+$(( $gaps / 2))"

newmails() {
	echo "$(ls "$MAIL/new" | wc -l)"
}

vol() {
	test "$(volume -s)" = "on" && volume || echo "!$(volume)"

}

# left bar
while :; do
	printf "%s%3s  %2d  %d\n" "%{c}" "$(vol)" "$(bat)" "$(newmails)"
	sleep 1s
done |\

lemonbar -d -g "$geometry_left" -f "$font" -B "${1:-#f0f0f0}" -F "${2:-#000000}" -n "bar" &

# right bar
while :; do
	printf "%s%(%d.%m  %I:%M)T\n" "%{c}"
	sleep 30s
done |\

lemonbar -d -g "$geometry_right" -f "$font" -B "${1:-#f0f0f0}" -F "${2:-#000000}" -n "bar" &

